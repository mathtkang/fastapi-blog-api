version: "3.8"
services:
  app:
    build:
      context: ./
      # dockerfile: Dockerfile
    ports:
      - 5468:5468
  
  postgres:
    image: postgres:latest
    container_name: postgres
    ports:
      # - "127.0.0.1:35000:5432"
      - 35000:5432
    volumes:
      - postgres-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=fastapi-practice
      - POSTGRES_USER=practice
      - POSTGRES_PASSWORD=devpassword

  nginx:
    image: nginx:latest
    container_name: nginx
    ports: 
      - 80:80
    volumes:
      - ./webserver/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - app

volumes:
  postgres-data:
    driver: local


# services:
#   web:
#     build: .
#     command: bash -c 'while !</dev/tcp/db/5432; do sleep 1; done; uvicorn app.main:app --host 0.0.0.0'
#     volumes:
#       - .:/app
#     ports:
#       - 8008:8000
#     environment:
#       - DATABASE_URL=postgresql://practice:devpassword@db:5432/fastapi-practice
#     depends_on:
#       - db
#   db:
#     image: postgres:latest
#     volumes:
#       - postgres_data:/var/lib/postgresql/data
#     expose:
#       - 5432
#     environment:
#       - POSTGRES_USER=practice
#       - POSTGRES_PASSWORD=devpassword
#       - POSTGRES_DB=fastapi-practice

# volumes:
# # This config will bind postgres_data to the "/var/lib/postgresql/data/" directory in the container.
#   postgres_data: